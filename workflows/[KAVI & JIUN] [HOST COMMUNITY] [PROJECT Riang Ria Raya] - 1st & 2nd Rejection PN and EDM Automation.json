{
  "active": false,
  "connections": {
    "Schedule Trigger1": {
      "main": [
        [
          {
            "node": "Google Sheets1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres2": {
      "main": [
        [
          {
            "node": "Function1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres": {
      "main": [
        [
          {
            "node": "Function4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets1": {
      "main": [
        [
          {
            "node": "Postgres2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Postgres",
            "type": "main",
            "index": 0
          },
          {
            "node": "Postgres1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Postgres3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres1": {
      "main": [
        [
          {
            "node": "Function",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres3": {
      "main": [
        [
          {
            "node": "Function2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Function1": {
      "main": [
        [
          {
            "node": "LP API - Send PN",
            "type": "main",
            "index": 0
          },
          {
            "node": "SIB API",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Function4": {
      "main": [
        [
          {
            "node": "LP API - Send PN1",
            "type": "main",
            "index": 0
          },
          {
            "node": "SIB API4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Function": {
      "main": [
        [
          {
            "node": "LP API - Send PN2",
            "type": "main",
            "index": 0
          },
          {
            "node": "SIB API1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Function2": {
      "main": [
        [
          {
            "node": "LP API - Send PN3",
            "type": "main",
            "index": 0
          },
          {
            "node": "SIB API2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SIB API": {
      "main": [
        [
          {
            "node": "Google Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "LP API - Send PN": {
      "main": [
        [
          {
            "node": "Google Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SIB API4": {
      "main": [
        [
          {
            "node": "Google Sheets2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "LP API - Send PN1": {
      "main": [
        [
          {
            "node": "Google Sheets2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SIB API1": {
      "main": [
        [
          {
            "node": "Google Sheets3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "LP API - Send PN2": {
      "main": [
        [
          {
            "node": "Google Sheets3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SIB API2": {
      "main": [
        [
          {
            "node": "Google Sheets4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "LP API - Send PN3": {
      "main": [
        [
          {
            "node": "Google Sheets4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2023-03-23T03:12:56.560Z",
  "id": "48",
  "name": "[KAVI & JIUN] [HOST COMMUNITY] [PROJECT Riang Ria Raya] - 1st & 2nd Rejection PN and EDM Automation",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes"
            }
          ]
        }
      },
      "id": "6029954d-ed50-46a2-8521-c582ffc499a5",
      "name": "Schedule Trigger1",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1,
      "position": [
        600,
        320
      ]
    },
    {
      "parameters": {
        "content": "## 1st Rejection Workflow (Non-Weekend rejection)\n✅",
        "height": 126.06914539275306,
        "width": 330.35458310776687
      },
      "id": "e1b9c08c-8eba-4b4d-94aa-4e9e9c5f56d9",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        256.1090909090911,
        -320
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "=SET TIMEZONE = 'Asia/Kuala_Lumpur';\n\nselect distinct l.id, \nl.registration_no, \nm.name as model,\ncase when ll.city_id in (1) then '1. KV'   \nwhen ll.city_id in (2,12) then '2. PG'\nwhen ll.city_id in (3,19,20,21) then '3. KK'  \nwhen ll.city_id in (4,15) then '4. JB' \nwhen ll.city_id in (5) then '5. IP' \nwhen ll.city_id in (47) then '6. NS'\nwhen ll.city_id in (13) then '7. LGK'\nelse '8. Others' end as city,\nl.user_id, \nconcat(u.first_name, ' ',u.last_name)as host_name, \ncase when ht.host_type is null then 'Organic' else ht.host_type end as host_type,\nu.email, \nu.uuid,\nu.phone_number,\nola.overall_avai_days,\ncase when obj.ov_rej_booking is null then '0' else obj.ov_rej_booking end as overall_rej_booking,\ncase when obj.unfair_rej_booking is null then '0' else obj.unfair_rej_booking end as unfair_rej_booking,\ncase when obj.real_rej_booking is null then '0' else obj.real_rej_booking end as real_rej_booking,\ncase when obf.overall_fuld_booking is null then '0' else obf.overall_fuld_booking end as overall_fuld_booking,\ncase when wbj.ov_rej_booking is null then '0' else wbj.ov_rej_booking end as weekend_overall_rej_booking,\ncase when wbj.unfair_rej_booking is null then '0' else wbj.unfair_rej_booking end as weekend_unfair_rej_booking,\ncase when wbj.real_rej_booking is null then '0' else wbj.real_rej_booking end as weekend_real_rej_booking,\nwla.weekend_avai_days,\ncase when wbf.weekend_fuld_booking is null then '0' else wbf.weekend_fuld_booking end as weekend_fuld_booking\nfrom listings l \nleft join users u on u.id = l.user_id\nleft join (select distinct listing_id, country, city_id from listing_location) ll on ll.listing_id = l.id\nleft join models m on m.id = l.model_id\nleft join companies c on c.owner_id = l.user_id\nleft join\n        (select distinct l.user_id, t.name as host_type\n        from listings l\n        left join tag_taggables tt on tt.taggable_id = l.user_id \n        left join tags t on t.id = tt.tag_id\n        where t.name ~* '(entrepreneur|commercial)')ht\n        on ht.user_id = l.user_id\n--\nleft join \n        (select distinct b.listing_id, \n        count(distinct case when (b.status = 'rejected' and (b.reason !~* '(guest)' or b.reason is null)) or (b.status in ('withdrawn', 'cancelled') and b.reason ~* '(host|owner|avai|car)') then b.ref_no end) as ov_rej_booking,\n\t\tcount(distinct case when (b.reason = 'Host is taking a long time to respond' and ((extract(EPOCH FROM b.updated_at::timestamp) - EXTRACT(EPOCH FROM b.created_at::timestamp))/60::integer)< '20' ) then b.ref_no end)as unfair_rej_booking,\n\t\tCOALESCE(count(distinct case when (b.status = 'rejected' and (b.reason !~* '(guest)' or b.reason is null)) or (b.status in ('withdrawn', 'cancelled') and b.reason ~* '(host|owner|avai|car)') then b.ref_no end) - count(distinct case when (b.reason = 'Host is taking a long time to respond' and ((extract(EPOCH FROM b.updated_at::timestamp) - EXTRACT(EPOCH FROM b.created_at::timestamp))/60::integer)< '20' ) then b.ref_no end),0) as real_rej_booking  \n        from bookings b \n        where b.request_end_at::timestamp >= '2023-04-20 00:00' and b.request_start_at::timestamp <= '2023-05-08 23:59'\n        group by 1)obj\n        on obj.listing_id = l.id\n--\nleft join \n        (select distinct b.listing_id, \n        count(distinct case when (b.status = 'rejected' and (b.reason !~* '(guest)' or b.reason is null)) or (b.status in ('withdrawn', 'cancelled') and b.reason ~* '(host|owner|avai|car)') then b.ref_no end) as ov_rej_booking,\n\t\tcount(distinct case when (b.reason = 'Host is taking a long time to respond' and ((extract(EPOCH FROM b.updated_at::timestamp) - EXTRACT(EPOCH FROM b.created_at::timestamp))/60::integer)< '20' ) then b.ref_no end)as unfair_rej_booking,\n\t\tCOALESCE(count(distinct case when (b.status = 'rejected' and (b.reason !~* '(guest)' or b.reason is null)) or (b.status in ('withdrawn', 'cancelled') and b.reason ~* '(host|owner|avai|car)') then b.ref_no end) - count(distinct case when (b.reason = 'Host is taking a long time to respond' and ((extract(EPOCH FROM b.updated_at::timestamp) - EXTRACT(EPOCH FROM b.created_at::timestamp))/60::integer)< '20' ) then b.ref_no end),0) as real_rej_booking\n        from bookings b \n        where (b.request_start_at::timestamp between '2023-04-21 00:00' and '2023-04-24 23:59') or (b.request_start_at::timestamp between '2023-04-28 00:00' and '2023-05-01 23:59') or (b.request_start_at::timestamp between '2023-05-04 00:00' and '2023-05-07 23:59')\n        group by 1)wbj\n        on wbj.listing_id = l.id\n--\nleft join \n        (select distinct b.listing_id, \n        count(distinct case when b.status in ('completed','start_driving','waiting_for_inspection', 'return_car','accepted') then b.id end) as overall_fuld_booking\n        from bookings b \n        where b.request_end_at::timestamp >= '2023-04-20 00:00' and b.request_start_at::timestamp <= '2023-05-08 23:59'\n        group by 1)obf\n        on obf.listing_id = l.id\n--\nleft join \n        (select distinct b.listing_id, \n        count(distinct case when b.status in ('completed','start_driving','waiting_for_inspection', 'return_car','accepted') then b.id end) as weekend_fuld_booking\n        from bookings b \n        where (b.request_start_at::timestamp between '2023-04-21 00:00' and '2023-04-24 23:59') or (b.request_start_at::timestamp between '2023-04-28 00:00' and '2023-05-01 23:59') or (b.request_start_at::timestamp between '2023-05-04 00:00' and '2023-05-07 23:59')\n        group by 1)wbf\n        on wbf.listing_id = l.id\n--\nleft join \n        (select l.id,\n        count(dates.ymd) as overall_avai_days\n        from listings l\n        left join listing_availability la on la.listing_id=l.id\n        left join (SELECT generate_series(timestamp '2023-04-20', timestamp '2023-05-08', interval '1 day')::date ymd) dates on \n        dates.ymd between la.start_date::date and la.end_date::date\n        where l.status='approved' and l.deleted_at is null \n        GROUP BY 1)ola\n        on ola.id = l.id\n--\nleft join \n        (select l.id,\n        count(case when (dates.ymd between '2023-04-21' and '2023-04-24') or (dates.ymd between '2023-04-28' and '2023-05-01') or (dates.ymd between '2023-05-04' and '2023-05-07') then dates.ymd end) as weekend_avai_days\n        from listings l\n        left join listing_availability la on la.listing_id=l.id\n        left join (SELECT generate_series(timestamp '2023-04-20', timestamp '2023-05-08', interval '1 day')::date ymd) dates on \n        dates.ymd between la.start_date::date and la.end_date::date\n        where l.status='approved' and l.deleted_at is null\n        GROUP BY 1)wla\n        on wla.id = l.id\nwhere l.status = 'approved'\nand l.deleted_at is null\n--and ((c.owner_id is null) or (l.user_id in (942862,344308,756223,31534,176936,551568,59693,120252,113801,483725,839440,760777,59551,58937,725875,797829,810417,1415199,1594773,50832,684922,1387955,548329,259352,81472,399266,79964,92561,93080,177014,89213,925742,758921,46071,1072616,1751078,82304)))\nand l.registration_no in ({{ $json[\"String\"] }})\nand obj.real_rej_booking = 1 and wbj.real_rej_booking = 0\ngroup by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20\nhaving (case when ht.host_type is null then 'Organic' else ht.host_type end) != 'Commercial Host' \norder by 11 desc",
        "additionalFields": {}
      },
      "id": "149fec47-2f89-4e73-a6b8-70584a54418d",
      "name": "Postgres2",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 1,
      "position": [
        1080,
        -340
      ],
      "credentials": {
        "postgres": {
          "id": "8",
          "name": "trevodb"
        }
      }
    },
    {
      "parameters": {
        "functionCode": "const staticData = getWorkflowStaticData('global');\nconst newListingIds = items.map(item => item.json[\"id\"]);\nconst oldListingIds = staticData.oldListingIds; \n\nif (!oldListingIds) {\n  staticData.oldListingIds = newListingIds;\n  return items;\n}\n\n\nconst ActualNewListingIds = newListingIds.filter((id) => !oldListingIds.includes(id));\nconst actualNewListing = items.filter((data) => ActualNewListingIds.includes(data.json['id']));\nstaticData.oldListingIds = [...ActualNewListingIds, ...oldListingIds];\n\nreturn actualNewListing;"
      },
      "name": "Function1",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        1280,
        -340
      ],
      "id": "18320ed2-b542-4670-ac43-a0d0666edb60"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "=SET TIMEZONE = 'Asia/Kuala_Lumpur';\n\nselect distinct l.id, \nl.registration_no, \nm.name as model,\ncase when ll.city_id in (1) then '1. KV'   \nwhen ll.city_id in (2,12) then '2. PG'\nwhen ll.city_id in (3,19,20,21) then '3. KK'  \nwhen ll.city_id in (4,15) then '4. JB' \nwhen ll.city_id in (5) then '5. IP' \nwhen ll.city_id in (47) then '6. NS'\nwhen ll.city_id in (13) then '7. LGK'\nelse '8. Others' end as city,\nl.user_id, \nconcat(u.first_name, ' ',u.last_name)as host_name, \ncase when ht.host_type is null then 'Organic' else ht.host_type end as host_type,\nu.email, \nu.uuid,\nu.phone_number,\nola.overall_avai_days,\ncase when obj.ov_rej_booking is null then '0' else obj.ov_rej_booking end as overall_rej_booking,\ncase when obj.unfair_rej_booking is null then '0' else obj.unfair_rej_booking end as unfair_rej_booking,\ncase when obj.real_rej_booking is null then '0' else obj.real_rej_booking end as real_rej_booking,\ncase when obf.overall_fuld_booking is null then '0' else obf.overall_fuld_booking end as overall_fuld_booking,\ncase when wbj.ov_rej_booking is null then '0' else wbj.ov_rej_booking end as weekend_overall_rej_booking,\ncase when wbj.unfair_rej_booking is null then '0' else wbj.unfair_rej_booking end as weekend_unfair_rej_booking,\ncase when wbj.real_rej_booking is null then '0' else wbj.real_rej_booking end as weekend_real_rej_booking,\nwla.weekend_avai_days,\ncase when wbf.weekend_fuld_booking is null then '0' else wbf.weekend_fuld_booking end as weekend_fuld_booking\nfrom listings l \nleft join users u on u.id = l.user_id\nleft join (select distinct listing_id, country, city_id from listing_location) ll on ll.listing_id = l.id\nleft join models m on m.id = l.model_id\nleft join companies c on c.owner_id = l.user_id\nleft join\n        (select distinct l.user_id, t.name as host_type\n        from listings l\n        left join tag_taggables tt on tt.taggable_id = l.user_id \n        left join tags t on t.id = tt.tag_id\n        where t.name ~* '(entrepreneur|commercial)')ht\n        on ht.user_id = l.user_id\n--\nleft join \n        (select distinct b.listing_id, \n        count(distinct case when (b.status = 'rejected' and (b.reason !~* '(guest)' or b.reason is null)) or (b.status in ('withdrawn', 'cancelled') and b.reason ~* '(host|owner|avai|car)') then b.ref_no end) as ov_rej_booking,\n\t\tcount(distinct case when (b.reason = 'Host is taking a long time to respond' and ((extract(EPOCH FROM b.updated_at::timestamp) - EXTRACT(EPOCH FROM b.created_at::timestamp))/60::integer)< '20' ) then b.ref_no end)as unfair_rej_booking,\n\t\tCOALESCE(count(distinct case when (b.status = 'rejected' and (b.reason !~* '(guest)' or b.reason is null)) or (b.status in ('withdrawn', 'cancelled') and b.reason ~* '(host|owner|avai|car)') then b.ref_no end) - count(distinct case when (b.reason = 'Host is taking a long time to respond' and ((extract(EPOCH FROM b.updated_at::timestamp) - EXTRACT(EPOCH FROM b.created_at::timestamp))/60::integer)< '20' ) then b.ref_no end),0) as real_rej_booking  \n        from bookings b \n        where b.request_end_at::timestamp >= '2023-04-20 00:00' and b.request_start_at::timestamp <= '2023-05-08 23:59'\n        group by 1)obj\n        on obj.listing_id = l.id\n--\nleft join \n        (select distinct b.listing_id, \n        count(distinct case when (b.status = 'rejected' and (b.reason !~* '(guest)' or b.reason is null)) or (b.status in ('withdrawn', 'cancelled') and b.reason ~* '(host|owner|avai|car)') then b.ref_no end) as ov_rej_booking,\n\t\tcount(distinct case when (b.reason = 'Host is taking a long time to respond' and ((extract(EPOCH FROM b.updated_at::timestamp) - EXTRACT(EPOCH FROM b.created_at::timestamp))/60::integer)< '20' ) then b.ref_no end)as unfair_rej_booking,\n\t\tCOALESCE(count(distinct case when (b.status = 'rejected' and (b.reason !~* '(guest)' or b.reason is null)) or (b.status in ('withdrawn', 'cancelled') and b.reason ~* '(host|owner|avai|car)') then b.ref_no end) - count(distinct case when (b.reason = 'Host is taking a long time to respond' and ((extract(EPOCH FROM b.updated_at::timestamp) - EXTRACT(EPOCH FROM b.created_at::timestamp))/60::integer)< '20' ) then b.ref_no end),0) as real_rej_booking\n        from bookings b \n        where (b.request_start_at::timestamp between '2023-04-21 00:00' and '2023-04-24 23:59') or (b.request_start_at::timestamp between '2023-04-28 00:00' and '2023-05-01 23:59') or (b.request_start_at::timestamp between '2023-05-04 00:00' and '2023-05-07 23:59')\n        group by 1)wbj\n        on wbj.listing_id = l.id\n--\nleft join \n        (select distinct b.listing_id, \n        count(distinct case when b.status in ('completed','start_driving','waiting_for_inspection', 'return_car','accepted') then b.id end) as overall_fuld_booking\n        from bookings b \n        where b.request_end_at::timestamp >= '2023-04-20 00:00' and b.request_start_at::timestamp <= '2023-05-08 23:59'\n        group by 1)obf\n        on obf.listing_id = l.id\n--\nleft join \n        (select distinct b.listing_id, \n        count(distinct case when b.status in ('completed','start_driving','waiting_for_inspection', 'return_car','accepted') then b.id end) as weekend_fuld_booking\n        from bookings b \n        where (b.request_start_at::timestamp between '2023-04-21 00:00' and '2023-04-24 23:59') or (b.request_start_at::timestamp between '2023-04-28 00:00' and '2023-05-01 23:59') or (b.request_start_at::timestamp between '2023-05-04 00:00' and '2023-05-07 23:59')\n        group by 1)wbf\n        on wbf.listing_id = l.id\n--\nleft join \n        (select l.id,\n        count(dates.ymd) as overall_avai_days\n        from listings l\n        left join listing_availability la on la.listing_id=l.id\n        left join (SELECT generate_series(timestamp '2023-04-20', timestamp '2023-05-08', interval '1 day')::date ymd) dates on \n        dates.ymd between la.start_date::date and la.end_date::date\n        where l.status='approved' and l.deleted_at is null \n        GROUP BY 1)ola\n        on ola.id = l.id\n--\nleft join \n        (select l.id,\n        count(case when (dates.ymd between '2023-04-21' and '2023-04-24') or (dates.ymd between '2023-04-28' and '2023-05-01') or (dates.ymd between '2023-05-04' and '2023-05-07') then dates.ymd end) as weekend_avai_days\n        from listings l\n        left join listing_availability la on la.listing_id=l.id\n        left join (SELECT generate_series(timestamp '2023-04-20', timestamp '2023-05-08', interval '1 day')::date ymd) dates on \n        dates.ymd between la.start_date::date and la.end_date::date\n        where l.status='approved' and l.deleted_at is null\n        GROUP BY 1)wla\n        on wla.id = l.id\nwhere l.status = 'approved'\nand l.deleted_at is null\n--and ((c.owner_id is null) or (l.user_id in (942862,344308,756223,31534,176936,551568,59693,120252,113801,483725,839440,760777,59551,58937,725875,797829,810417,1415199,1594773,50832,684922,1387955,548329,259352,81472,399266,79964,92561,93080,177014,89213,925742,758921,46071,1072616,1751078,82304)))\nand l.registration_no in ({{ $json[\"String\"] }})\nand obj.real_rej_booking = 2 and wbj.real_rej_booking = 0\ngroup by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20\nhaving (case when ht.host_type is null then 'Organic' else ht.host_type end) != 'Commercial Host' \norder by 11 desc",
        "additionalFields": {}
      },
      "id": "5412b629-2992-46f6-904d-6788836a8d24",
      "name": "Postgres",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 1,
      "position": [
        1080,
        100
      ],
      "credentials": {
        "postgres": {
          "id": "8",
          "name": "trevodb"
        }
      }
    },
    {
      "parameters": {
        "content": "## 2nd Rejection Workflow (Non-Weekend rejection)\n✅",
        "height": 117.39042494769045,
        "width": 330.35458310776687
      },
      "id": "7c8be9b3-d4fb-4945-b7ca-52a1f1b99e93",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        260,
        100
      ]
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1gn-IkSCx1U3MalPpf6pSyvsC71QgxdF5XZ-xsWcQtZY",
          "mode": "list",
          "cachedResultName": "Riang Ria Raya Opt-In Form (Responses)",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1gn-IkSCx1U3MalPpf6pSyvsC71QgxdF5XZ-xsWcQtZY/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2055962237,
          "mode": "list",
          "cachedResultName": "Registration No",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1gn-IkSCx1U3MalPpf6pSyvsC71QgxdF5XZ-xsWcQtZY/edit#gid=2055962237"
        },
        "options": {}
      },
      "id": "36fd8e20-ce89-4ef0-a221-191a53120fcb",
      "name": "Google Sheets1",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 3,
      "position": [
        800,
        320
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "19",
          "name": "Google Sheet - Jiun's Account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "=SET TIMEZONE = 'Asia/Kuala_Lumpur';\n\nselect distinct l.id, \nl.registration_no, \nm.name as model,\ncase when ll.city_id in (1) then '1. KV'   \nwhen ll.city_id in (2,12) then '2. PG'\nwhen ll.city_id in (3,19,20,21) then '3. KK'  \nwhen ll.city_id in (4,15) then '4. JB' \nwhen ll.city_id in (5) then '5. IP' \nwhen ll.city_id in (47) then '6. NS'\nwhen ll.city_id in (13) then '7. LGK'\nelse '8. Others' end as city,\nl.user_id, \nconcat(u.first_name, ' ',u.last_name)as host_name, \ncase when ht.host_type is null then 'Organic' else ht.host_type end as host_type,\nu.email, \nu.uuid,\nu.phone_number,\nola.overall_avai_days,\ncase when obj.ov_rej_booking is null then '0' else obj.ov_rej_booking end as overall_rej_booking,\ncase when obj.unfair_rej_booking is null then '0' else obj.unfair_rej_booking end as unfair_rej_booking,\ncase when obj.real_rej_booking is null then '0' else obj.real_rej_booking end as real_rej_booking,\ncase when obf.overall_fuld_booking is null then '0' else obf.overall_fuld_booking end as overall_fuld_booking,\ncase when wbj.ov_rej_booking is null then '0' else wbj.ov_rej_booking end as weekend_overall_rej_booking,\ncase when wbj.unfair_rej_booking is null then '0' else wbj.unfair_rej_booking end as weekend_unfair_rej_booking,\ncase when wbj.real_rej_booking is null then '0' else wbj.real_rej_booking end as weekend_real_rej_booking,\nwla.weekend_avai_days,\ncase when wbf.weekend_fuld_booking is null then '0' else wbf.weekend_fuld_booking end as weekend_fuld_booking\nfrom listings l \nleft join users u on u.id = l.user_id\nleft join (select distinct listing_id, country, city_id from listing_location) ll on ll.listing_id = l.id\nleft join models m on m.id = l.model_id\nleft join companies c on c.owner_id = l.user_id\nleft join\n        (select distinct l.user_id, t.name as host_type\n        from listings l\n        left join tag_taggables tt on tt.taggable_id = l.user_id \n        left join tags t on t.id = tt.tag_id\n        where t.name ~* '(entrepreneur|commercial)')ht\n        on ht.user_id = l.user_id\n--\nleft join \n        (select distinct b.listing_id, \n        count(distinct case when (b.status = 'rejected' and (b.reason !~* '(guest)' or b.reason is null)) or (b.status in ('withdrawn', 'cancelled') and b.reason ~* '(host|owner|avai|car)') then b.ref_no end) as ov_rej_booking,\n\t\tcount(distinct case when (b.reason = 'Host is taking a long time to respond' and ((extract(EPOCH FROM b.updated_at::timestamp) - EXTRACT(EPOCH FROM b.created_at::timestamp))/60::integer)< '20' ) then b.ref_no end)as unfair_rej_booking,\n\t\tCOALESCE(count(distinct case when (b.status = 'rejected' and (b.reason !~* '(guest)' or b.reason is null)) or (b.status in ('withdrawn', 'cancelled') and b.reason ~* '(host|owner|avai|car)') then b.ref_no end) - count(distinct case when (b.reason = 'Host is taking a long time to respond' and ((extract(EPOCH FROM b.updated_at::timestamp) - EXTRACT(EPOCH FROM b.created_at::timestamp))/60::integer)< '20' ) then b.ref_no end),0) as real_rej_booking  \n        from bookings b \n        where b.request_end_at::timestamp >= '2023-04-20 00:00' and b.request_start_at::timestamp <= '2023-05-08 23:59'\n        group by 1)obj\n        on obj.listing_id = l.id\n--\nleft join \n        (select distinct b.listing_id, \n        count(distinct case when (b.status = 'rejected' and (b.reason !~* '(guest)' or b.reason is null)) or (b.status in ('withdrawn', 'cancelled') and b.reason ~* '(host|owner|avai|car)') then b.ref_no end) as ov_rej_booking,\n\t\tcount(distinct case when (b.reason = 'Host is taking a long time to respond' and ((extract(EPOCH FROM b.updated_at::timestamp) - EXTRACT(EPOCH FROM b.created_at::timestamp))/60::integer)< '20' ) then b.ref_no end)as unfair_rej_booking,\n\t\tCOALESCE(count(distinct case when (b.status = 'rejected' and (b.reason !~* '(guest)' or b.reason is null)) or (b.status in ('withdrawn', 'cancelled') and b.reason ~* '(host|owner|avai|car)') then b.ref_no end) - count(distinct case when (b.reason = 'Host is taking a long time to respond' and ((extract(EPOCH FROM b.updated_at::timestamp) - EXTRACT(EPOCH FROM b.created_at::timestamp))/60::integer)< '20' ) then b.ref_no end),0) as real_rej_booking\n        from bookings b \n        where (b.request_start_at::timestamp between '2023-04-21 00:00' and '2023-04-24 23:59') or (b.request_start_at::timestamp between '2023-04-28 00:00' and '2023-05-01 23:59') or (b.request_start_at::timestamp between '2023-05-04 00:00' and '2023-05-07 23:59')\n        group by 1)wbj\n        on wbj.listing_id = l.id\n--\nleft join \n        (select distinct b.listing_id, \n        count(distinct case when b.status in ('completed','start_driving','waiting_for_inspection', 'return_car','accepted') then b.id end) as overall_fuld_booking\n        from bookings b \n        where b.request_end_at::timestamp >= '2023-04-20 00:00' and b.request_start_at::timestamp <= '2023-05-08 23:59'\n        group by 1)obf\n        on obf.listing_id = l.id\n--\nleft join \n        (select distinct b.listing_id, \n        count(distinct case when b.status in ('completed','start_driving','waiting_for_inspection', 'return_car','accepted') then b.id end) as weekend_fuld_booking\n        from bookings b \n        where (b.request_start_at::timestamp between '2023-04-21 00:00' and '2023-04-24 23:59') or (b.request_start_at::timestamp between '2023-04-28 00:00' and '2023-05-01 23:59') or (b.request_start_at::timestamp between '2023-05-04 00:00' and '2023-05-07 23:59')\n        group by 1)wbf\n        on wbf.listing_id = l.id\n--\nleft join \n        (select l.id,\n        count(dates.ymd) as overall_avai_days\n        from listings l\n        left join listing_availability la on la.listing_id=l.id\n        left join (SELECT generate_series(timestamp '2023-04-20', timestamp '2023-05-08', interval '1 day')::date ymd) dates on \n        dates.ymd between la.start_date::date and la.end_date::date\n        where l.status='approved' and l.deleted_at is null \n        GROUP BY 1)ola\n        on ola.id = l.id\n--\nleft join \n        (select l.id,\n        count(case when (dates.ymd between '2023-04-21' and '2023-04-24') or (dates.ymd between '2023-04-28' and '2023-05-01') or (dates.ymd between '2023-05-04' and '2023-05-07') then dates.ymd end) as weekend_avai_days\n        from listings l\n        left join listing_availability la on la.listing_id=l.id\n        left join (SELECT generate_series(timestamp '2023-04-20', timestamp '2023-05-08', interval '1 day')::date ymd) dates on \n        dates.ymd between la.start_date::date and la.end_date::date\n        where l.status='approved' and l.deleted_at is null\n        GROUP BY 1)wla\n        on wla.id = l.id\nwhere l.status = 'approved'\nand l.deleted_at is null\n--and ((c.owner_id is null) or (l.user_id in (942862,344308,756223,31534,176936,551568,59693,120252,113801,483725,839440,760777,59551,58937,725875,797829,810417,1415199,1594773,50832,684922,1387955,548329,259352,81472,399266,79964,92561,93080,177014,89213,925742,758921,46071,1072616,1751078,82304)))\nand l.registration_no in ({{ $json[\"String\"] }})\nand wbj.real_rej_booking = 1 and obj.real_rej_booking <= 2\ngroup by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20\nhaving (case when ht.host_type is null then 'Organic' else ht.host_type end) != 'Commercial Host' \norder by 11 desc",
        "additionalFields": {}
      },
      "id": "2f42038b-60dc-4bab-bfe1-f29e21dbbf98",
      "name": "Postgres1",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 1,
      "position": [
        1080,
        540
      ],
      "credentials": {
        "postgres": {
          "id": "8",
          "name": "trevodb"
        }
      }
    },
    {
      "parameters": {
        "content": "## 1st Rejection Workflow (Weekend rejection)\n✅",
        "height": 113.56425223306154,
        "width": 329.06367401685776
      },
      "id": "734f80d0-2528-4c93-9e71-e66b298055e8",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        260,
        540
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "=SET TIMEZONE = 'Asia/Kuala_Lumpur';\n\nselect distinct l.id, \nl.registration_no, \nm.name as model,\ncase when ll.city_id in (1) then '1. KV'   \nwhen ll.city_id in (2,12) then '2. PG'\nwhen ll.city_id in (3,19,20,21) then '3. KK'  \nwhen ll.city_id in (4,15) then '4. JB' \nwhen ll.city_id in (5) then '5. IP' \nwhen ll.city_id in (47) then '6. NS'\nwhen ll.city_id in (13) then '7. LGK'\nelse '8. Others' end as city,\nl.user_id, \nconcat(u.first_name, ' ',u.last_name)as host_name, \ncase when ht.host_type is null then 'Organic' else ht.host_type end as host_type,\nu.email, \nu.uuid,\nu.phone_number,\nola.overall_avai_days,\ncase when obj.ov_rej_booking is null then '0' else obj.ov_rej_booking end as overall_rej_booking,\ncase when obj.unfair_rej_booking is null then '0' else obj.unfair_rej_booking end as unfair_rej_booking,\ncase when obj.real_rej_booking is null then '0' else obj.real_rej_booking end as real_rej_booking,\ncase when obf.overall_fuld_booking is null then '0' else obf.overall_fuld_booking end as overall_fuld_booking,\ncase when wbj.ov_rej_booking is null then '0' else wbj.ov_rej_booking end as weekend_overall_rej_booking,\ncase when wbj.unfair_rej_booking is null then '0' else wbj.unfair_rej_booking end as weekend_unfair_rej_booking,\ncase when wbj.real_rej_booking is null then '0' else wbj.real_rej_booking end as weekend_real_rej_booking,\nwla.weekend_avai_days,\ncase when wbf.weekend_fuld_booking is null then '0' else wbf.weekend_fuld_booking end as weekend_fuld_booking\nfrom listings l \nleft join users u on u.id = l.user_id\nleft join (select distinct listing_id, country, city_id from listing_location) ll on ll.listing_id = l.id\nleft join models m on m.id = l.model_id\nleft join companies c on c.owner_id = l.user_id\nleft join\n        (select distinct l.user_id, t.name as host_type\n        from listings l\n        left join tag_taggables tt on tt.taggable_id = l.user_id \n        left join tags t on t.id = tt.tag_id\n        where t.name ~* '(entrepreneur|commercial)')ht\n        on ht.user_id = l.user_id\n--\nleft join \n        (select distinct b.listing_id, \n        count(distinct case when (b.status = 'rejected' and (b.reason !~* '(guest)' or b.reason is null)) or (b.status in ('withdrawn', 'cancelled') and b.reason ~* '(host|owner|avai|car)') then b.ref_no end) as ov_rej_booking,\n\t\tcount(distinct case when (b.reason = 'Host is taking a long time to respond' and ((extract(EPOCH FROM b.updated_at::timestamp) - EXTRACT(EPOCH FROM b.created_at::timestamp))/60::integer)< '20' ) then b.ref_no end)as unfair_rej_booking,\n\t\tCOALESCE(count(distinct case when (b.status = 'rejected' and (b.reason !~* '(guest)' or b.reason is null)) or (b.status in ('withdrawn', 'cancelled') and b.reason ~* '(host|owner|avai|car)') then b.ref_no end) - count(distinct case when (b.reason = 'Host is taking a long time to respond' and ((extract(EPOCH FROM b.updated_at::timestamp) - EXTRACT(EPOCH FROM b.created_at::timestamp))/60::integer)< '20' ) then b.ref_no end),0) as real_rej_booking  \n        from bookings b \n        where b.request_end_at::timestamp >= '2023-04-20 00:00' and b.request_start_at::timestamp <= '2023-05-08 23:59'\n        group by 1)obj\n        on obj.listing_id = l.id\n--\nleft join \n        (select distinct b.listing_id, \n        count(distinct case when (b.status = 'rejected' and (b.reason !~* '(guest)' or b.reason is null)) or (b.status in ('withdrawn', 'cancelled') and b.reason ~* '(host|owner|avai|car)') then b.ref_no end) as ov_rej_booking,\n\t\tcount(distinct case when (b.reason = 'Host is taking a long time to respond' and ((extract(EPOCH FROM b.updated_at::timestamp) - EXTRACT(EPOCH FROM b.created_at::timestamp))/60::integer)< '20' ) then b.ref_no end)as unfair_rej_booking,\n\t\tCOALESCE(count(distinct case when (b.status = 'rejected' and (b.reason !~* '(guest)' or b.reason is null)) or (b.status in ('withdrawn', 'cancelled') and b.reason ~* '(host|owner|avai|car)') then b.ref_no end) - count(distinct case when (b.reason = 'Host is taking a long time to respond' and ((extract(EPOCH FROM b.updated_at::timestamp) - EXTRACT(EPOCH FROM b.created_at::timestamp))/60::integer)< '20' ) then b.ref_no end),0) as real_rej_booking\n        from bookings b \n        where (b.request_start_at::timestamp between '2023-04-21 00:00' and '2023-04-24 23:59') or (b.request_start_at::timestamp between '2023-04-28 00:00' and '2023-05-01 23:59') or (b.request_start_at::timestamp between '2023-05-04 00:00' and '2023-05-07 23:59')\n        group by 1)wbj\n        on wbj.listing_id = l.id\n--\nleft join \n        (select distinct b.listing_id, \n        count(distinct case when b.status in ('completed','start_driving','waiting_for_inspection', 'return_car','accepted') then b.id end) as overall_fuld_booking\n        from bookings b \n        where b.request_end_at::timestamp >= '2023-04-20 00:00' and b.request_start_at::timestamp <= '2023-05-08 23:59'\n        group by 1)obf\n        on obf.listing_id = l.id\n--\nleft join \n        (select distinct b.listing_id, \n        count(distinct case when b.status in ('completed','start_driving','waiting_for_inspection', 'return_car','accepted') then b.id end) as weekend_fuld_booking\n        from bookings b \n        where (b.request_start_at::timestamp between '2023-04-21 00:00' and '2023-04-24 23:59') or (b.request_start_at::timestamp between '2023-04-28 00:00' and '2023-05-01 23:59') or (b.request_start_at::timestamp between '2023-05-04 00:00' and '2023-05-07 23:59')\n        group by 1)wbf\n        on wbf.listing_id = l.id\n--\nleft join \n        (select l.id,\n        count(dates.ymd) as overall_avai_days\n        from listings l\n        left join listing_availability la on la.listing_id=l.id\n        left join (SELECT generate_series(timestamp '2023-04-20', timestamp '2023-05-08', interval '1 day')::date ymd) dates on \n        dates.ymd between la.start_date::date and la.end_date::date\n        where l.status='approved' and l.deleted_at is null \n        GROUP BY 1)ola\n        on ola.id = l.id\n--\nleft join \n        (select l.id,\n        count(case when (dates.ymd between '2023-04-21' and '2023-04-24') or (dates.ymd between '2023-04-28' and '2023-05-01') or (dates.ymd between '2023-05-04' and '2023-05-07') then dates.ymd end) as weekend_avai_days\n        from listings l\n        left join listing_availability la on la.listing_id=l.id\n        left join (SELECT generate_series(timestamp '2023-04-20', timestamp '2023-05-08', interval '1 day')::date ymd) dates on \n        dates.ymd between la.start_date::date and la.end_date::date\n        where l.status='approved' and l.deleted_at is null\n        GROUP BY 1)wla\n        on wla.id = l.id\nwhere l.status = 'approved'\nand l.deleted_at is null\n--and ((c.owner_id is null) or (l.user_id in (942862,344308,756223,31534,176936,551568,59693,120252,113801,483725,839440,760777,59551,58937,725875,797829,810417,1415199,1594773,50832,684922,1387955,548329,259352,81472,399266,79964,92561,93080,177014,89213,925742,758921,46071,1072616,1751078,82304)))\nand l.registration_no in ({{ $json[\"String\"] }})\nand (wbj.real_rej_booking > 1 or obj.real_rej_booking > 2)\ngroup by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20\nhaving (case when ht.host_type is null then 'Organic' else ht.host_type end) != 'Commercial Host' \norder by 11 desc",
        "additionalFields": {}
      },
      "id": "1f267410-e8f2-4e35-8a57-0deb0a147835",
      "name": "Postgres3",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 1,
      "position": [
        1080,
        980
      ],
      "credentials": {
        "postgres": {
          "id": "8",
          "name": "trevodb"
        }
      }
    },
    {
      "parameters": {
        "content": "## Disqualified Workflow",
        "height": 80,
        "width": 329.06367401685776
      },
      "id": "52b3b429-f1bc-4305-85e7-151dcf276c6e",
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        260,
        980
      ]
    },
    {
      "parameters": {
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "sendInBlueApi",
        "requestMethod": "POST",
        "url": "https://api.sendinblue.com/v3/smtp/email",
        "jsonParameters": true,
        "options": {},
        "bodyParametersJson": "={\"to\":[{\"email\":\"{{$json[\"email\"]}}\",\"name\":\"{{$json[\"host_name\"]}}\"}],\n\"templateId\":518,\"params\":{ \"HOSTNAME\":\"{{$json[\"host_name\"]}}\"}}\n\n",
        "headerParametersJson": "={\"accept\": \"application/json\",\"content-type\": \"application/json\"}"
      },
      "name": "SIB API",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 2,
      "position": [
        1500,
        -460
      ],
      "id": "7acc0ea8-4ce7-489a-9c5e-1d041f184594",
      "retryOnFail": true,
      "credentials": {
        "sendInBlueApi": {
          "id": "7",
          "name": "SendInBlue"
        }
      },
      "continueOnFail": true
    },
    {
      "parameters": {
        "requestMethod": "POST",
        "url": "https://api.leanplum.com/api?action=startCampaign",
        "jsonParameters": true,
        "options": {},
        "bodyParametersJson": "={ \"appId\" : \"app_BXrjE7dc15VWXDLRfh77tActhBhSkCHeQhETDE1mXfQ\", \"clientKey\" : \"dev_L9yBjOmwfR3fNiVjL9woIYfWzsy5hMcGDx0og8isAFw\", \"apiVersion\" : \"1.0.6\", \"userId\":\"{{ $json[\"uuid\"] }}\", \"campaignId\":\"5787056781983744\", \"createDisposition\" : \"CreateNever\"}",
        "headerParametersJson": "={\"accept\": \"application/json\",\"content-type\": \"application/json\"}"
      },
      "name": "LP API - Send PN",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 2,
      "position": [
        1500,
        -220
      ],
      "id": "f2f5f0fd-bc82-4c04-96e8-083738d91238"
    },
    {
      "parameters": {
        "requestMethod": "POST",
        "url": "https://api.leanplum.com/api?action=startCampaign",
        "jsonParameters": true,
        "options": {},
        "bodyParametersJson": "={ \"appId\" : \"app_BXrjE7dc15VWXDLRfh77tActhBhSkCHeQhETDE1mXfQ\", \"clientKey\" : \"dev_L9yBjOmwfR3fNiVjL9woIYfWzsy5hMcGDx0og8isAFw\", \"apiVersion\" : \"1.0.6\", \"userId\":\"{{ $json[\"uuid\"] }}\", \"campaignId\":\"5088212050051072\", \"createDisposition\" : \"CreateNever\"}",
        "headerParametersJson": "={\"accept\": \"application/json\",\"content-type\": \"application/json\"}"
      },
      "name": "LP API - Send PN1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 2,
      "position": [
        1500,
        240
      ],
      "id": "ede249f0-d83e-4420-aafa-4008ac5ceea5"
    },
    {
      "parameters": {
        "requestMethod": "POST",
        "url": "https://api.leanplum.com/api?action=startCampaign",
        "jsonParameters": true,
        "options": {},
        "bodyParametersJson": "={ \"appId\" : \"app_BXrjE7dc15VWXDLRfh77tActhBhSkCHeQhETDE1mXfQ\", \"clientKey\" : \"dev_L9yBjOmwfR3fNiVjL9woIYfWzsy5hMcGDx0og8isAFw\", \"apiVersion\" : \"1.0.6\", \"userId\":\"{{ $json[\"uuid\"] }}\", \"campaignId\":\"5107995676049408\", \"createDisposition\" : \"CreateNever\"}",
        "headerParametersJson": "={\"accept\": \"application/json\",\"content-type\": \"application/json\"}"
      },
      "name": "LP API - Send PN2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 2,
      "position": [
        1500,
        680
      ],
      "id": "33ac9e2e-cd53-4ab9-8df6-40ba8067d2a4"
    },
    {
      "parameters": {
        "requestMethod": "POST",
        "url": "https://api.leanplum.com/api?action=startCampaign",
        "jsonParameters": true,
        "options": {},
        "bodyParametersJson": "={ \"appId\" : \"app_BXrjE7dc15VWXDLRfh77tActhBhSkCHeQhETDE1mXfQ\", \"clientKey\" : \"dev_L9yBjOmwfR3fNiVjL9woIYfWzsy5hMcGDx0og8isAFw\", \"apiVersion\" : \"1.0.6\", \"userId\":\"{{ $json[\"uuid\"] }}\", \"campaignId\":\"5182178015641600\", \"createDisposition\" : \"CreateNever\"}",
        "headerParametersJson": "={\"accept\": \"application/json\",\"content-type\": \"application/json\"}"
      },
      "name": "LP API - Send PN3",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 2,
      "position": [
        1500,
        1120
      ],
      "id": "aa6002cd-b1d8-483b-9e3b-d0e70845c67f"
    },
    {
      "parameters": {
        "functionCode": "const staticData = getWorkflowStaticData('global');\nconst newListingIds = items.map(item => item.json[\"registration_no\"]);\nconst oldListingIds = staticData.oldListingIds; \n\nif (!oldListingIds) {\n  staticData.oldListingIds = newListingIds;\n  return items;\n}\n\n\nconst ActualNewListingIds = newListingIds.filter((id) => !oldListingIds.includes(id));\nconst actualNewListing = items.filter((data) => ActualNewListingIds.includes(data.json['registration_no']));\nstaticData.oldListingIds = [...ActualNewListingIds, ...oldListingIds];\n\nreturn actualNewListing;"
      },
      "name": "Function4",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        1280,
        100
      ],
      "id": "513c6085-a390-4aa3-bad7-f641b6f37550"
    },
    {
      "parameters": {
        "functionCode": "const staticData = getWorkflowStaticData('global');\nconst newListingIds = items.map(item => item.json[\"registration_no\"]);\nconst oldListingIds = staticData.oldListingIds; \n\nif (!oldListingIds) {\n  staticData.oldListingIds = newListingIds;\n  return items;\n}\n\n\nconst ActualNewListingIds = newListingIds.filter((id) => !oldListingIds.includes(id));\nconst actualNewListing = items.filter((data) => ActualNewListingIds.includes(data.json['registration_no']));\nstaticData.oldListingIds = [...ActualNewListingIds, ...oldListingIds];\n\nreturn actualNewListing;"
      },
      "name": "Function",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        1280,
        540
      ],
      "id": "6d3e7ba8-ea69-4118-892b-1160ee96d743"
    },
    {
      "parameters": {
        "functionCode": "const staticData = getWorkflowStaticData('global');\nconst newListingIds = items.map(item => item.json[\"registration_no\"]);\nconst oldListingIds = staticData.oldListingIds; \n\nif (!oldListingIds) {\n  staticData.oldListingIds = newListingIds;\n  return items;\n}\n\n\nconst ActualNewListingIds = newListingIds.filter((id) => !oldListingIds.includes(id));\nconst actualNewListing = items.filter((data) => ActualNewListingIds.includes(data.json['registration_no']));\nstaticData.oldListingIds = [...ActualNewListingIds, ...oldListingIds];\n\nreturn actualNewListing;"
      },
      "name": "Function2",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        1280,
        980
      ],
      "id": "69c755a9-838d-4d2f-9d38-6f422ea52212"
    },
    {
      "parameters": {
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "sendInBlueApi",
        "requestMethod": "POST",
        "url": "https://api.sendinblue.com/v3/smtp/email",
        "jsonParameters": true,
        "options": {},
        "bodyParametersJson": "={\"to\":[{\"email\":\"{{$json[\"email\"]}}\",\"name\":\"{{$json[\"host_name\"]}}\"}],\n\"templateId\":519,\"params\":{ \"HOSTNAME\":\"{{$json[\"host_name\"]}}\"}}\n\n",
        "headerParametersJson": "={\"accept\": \"application/json\",\"content-type\": \"application/json\"}"
      },
      "name": "SIB API4",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 2,
      "position": [
        1500,
        20
      ],
      "id": "f228af95-0edd-4445-b094-203bfc492dfc",
      "retryOnFail": true,
      "credentials": {
        "sendInBlueApi": {
          "id": "7",
          "name": "SendInBlue"
        }
      },
      "continueOnFail": true
    },
    {
      "parameters": {
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "sendInBlueApi",
        "requestMethod": "POST",
        "url": "https://api.sendinblue.com/v3/smtp/email",
        "jsonParameters": true,
        "options": {},
        "bodyParametersJson": "={\"to\":[{\"email\":\"{{$json[\"email\"]}}\",\"name\":\"{{$json[\"host_name\"]}}\"}],\n\"templateId\":522,\"params\":{ \"HOSTNAME\":\"{{$json[\"host_name\"]}}\"}}\n\n",
        "headerParametersJson": "={\"accept\": \"application/json\",\"content-type\": \"application/json\"}"
      },
      "name": "SIB API1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 2,
      "position": [
        1500,
        480
      ],
      "id": "ba4cdee0-cf00-453f-8de7-c61f47723a7d",
      "retryOnFail": true,
      "credentials": {
        "sendInBlueApi": {
          "id": "7",
          "name": "SendInBlue"
        }
      },
      "continueOnFail": true
    },
    {
      "parameters": {
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "sendInBlueApi",
        "requestMethod": "POST",
        "url": "https://api.sendinblue.com/v3/smtp/email",
        "jsonParameters": true,
        "options": {},
        "bodyParametersJson": "={\"to\":[{\"email\":\"{{$json[\"email\"]}}\",\"name\":\"{{$json[\"host_name\"]}}\"}],\n\"templateId\":560,\"params\":{ \"HOSTNAME\":\"{{$json[\"host_name\"]}}\", \"RRCPLATE\":\"{{$json[\"registration_no\"]}}\"}}\n\n",
        "headerParametersJson": "={\"accept\": \"application/json\",\"content-type\": \"application/json\"}"
      },
      "name": "SIB API2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 2,
      "position": [
        1500,
        920
      ],
      "id": "e0b85381-a4b0-4593-9b41-1f75936653a4",
      "retryOnFail": true,
      "credentials": {
        "sendInBlueApi": {
          "id": "7",
          "name": "SendInBlue"
        }
      },
      "continueOnFail": true
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1YLMEmBnbZNbvwDypwpwoNQwV2Vc2OaGoVCkFnym5CGw",
          "mode": "list",
          "cachedResultName": "PNTracker - Ong",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1YLMEmBnbZNbvwDypwpwoNQwV2Vc2OaGoVCkFnym5CGw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "REJ1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1YLMEmBnbZNbvwDypwpwoNQwV2Vc2OaGoVCkFnym5CGw/edit#gid=0"
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "id",
              "fieldValue": "={{ $node[\"Postgres2\"].json[\"id\"] }}"
            },
            {
              "fieldId": "reg_no",
              "fieldValue": "={{ $node[\"Postgres2\"].json[\"registration_no\"] }}"
            },
            {
              "fieldId": "host_name",
              "fieldValue": "={{ $node[\"Postgres2\"].json[\"host_name\"] }}"
            },
            {
              "fieldId": "ovr_rej",
              "fieldValue": "={{ $node[\"Postgres2\"].json[\"real_rej_booking\"] }}"
            },
            {
              "fieldId": "week_rej",
              "fieldValue": "={{ $node[\"Postgres2\"].json[\"weekend_real_rej_booking\"] }}"
            },
            {
              "fieldId": "lp_true_false",
              "fieldValue": "={{ $json[\"response\"][0][\"success\"] }}"
            },
            {
              "fieldId": "sendinblue_true_false",
              "fieldValue": "={{ $json[\"messageId\"] }}"
            },
            {
              "fieldId": "timestamp",
              "fieldValue": "={{ $node[\"Schedule Trigger1\"].json[\"timestamp\"] }}"
            }
          ]
        },
        "options": {
          "cellFormat": "USER_ENTERED"
        }
      },
      "id": "285082f3-9b05-4680-917d-a06218cce08d",
      "name": "Google Sheets",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 3,
      "position": [
        1760,
        -340
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "15",
          "name": "Google Sheets - Kavi"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1YLMEmBnbZNbvwDypwpwoNQwV2Vc2OaGoVCkFnym5CGw",
          "mode": "list",
          "cachedResultName": "PNTracker - Ong",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1YLMEmBnbZNbvwDypwpwoNQwV2Vc2OaGoVCkFnym5CGw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 514700573,
          "mode": "list",
          "cachedResultName": "REJ2",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1YLMEmBnbZNbvwDypwpwoNQwV2Vc2OaGoVCkFnym5CGw/edit#gid=514700573"
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "id",
              "fieldValue": "={{ $node[\"Postgres2\"].json[\"id\"] }}"
            },
            {
              "fieldId": "reg_no",
              "fieldValue": "={{ $node[\"Postgres2\"].json[\"registration_no\"] }}"
            },
            {
              "fieldId": "host_name",
              "fieldValue": "={{ $node[\"Postgres2\"].json[\"host_name\"] }}"
            },
            {
              "fieldId": "ovr_rej",
              "fieldValue": "={{ $node[\"Postgres2\"].json[\"real_rej_booking\"] }}"
            },
            {
              "fieldId": "week_rej",
              "fieldValue": "={{ $node[\"Postgres2\"].json[\"weekend_real_rej_booking\"] }}"
            },
            {
              "fieldId": "lp_true_false",
              "fieldValue": "={{ $json[\"response\"][0][\"success\"] }}"
            },
            {
              "fieldId": "sendinblue_true_false",
              "fieldValue": "={{ $json[\"messageId\"] }}"
            },
            {
              "fieldId": "timestamp",
              "fieldValue": "={{ $node[\"Schedule Trigger1\"].json[\"timestamp\"] }}"
            }
          ]
        },
        "options": {
          "cellFormat": "USER_ENTERED"
        }
      },
      "id": "516ed812-3735-47f6-9748-fc1ffa242c41",
      "name": "Google Sheets2",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 3,
      "position": [
        1740,
        100
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "15",
          "name": "Google Sheets - Kavi"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1YLMEmBnbZNbvwDypwpwoNQwV2Vc2OaGoVCkFnym5CGw",
          "mode": "list",
          "cachedResultName": "PNTracker - Ong",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1YLMEmBnbZNbvwDypwpwoNQwV2Vc2OaGoVCkFnym5CGw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1757594587,
          "mode": "list",
          "cachedResultName": "WEREJ1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1YLMEmBnbZNbvwDypwpwoNQwV2Vc2OaGoVCkFnym5CGw/edit#gid=1757594587"
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "id",
              "fieldValue": "={{ $node[\"Postgres2\"].json[\"id\"] }}"
            },
            {
              "fieldId": "reg_no",
              "fieldValue": "={{ $node[\"Postgres2\"].json[\"registration_no\"] }}"
            },
            {
              "fieldId": "host_name",
              "fieldValue": "={{ $node[\"Postgres2\"].json[\"host_name\"] }}"
            },
            {
              "fieldId": "ovr_rej",
              "fieldValue": "={{ $node[\"Postgres2\"].json[\"real_rej_booking\"] }}"
            },
            {
              "fieldId": "week_rej",
              "fieldValue": "={{ $node[\"Postgres2\"].json[\"weekend_real_rej_booking\"] }}"
            },
            {
              "fieldId": "lp_true_false",
              "fieldValue": "={{ $json[\"response\"][0][\"success\"] }}"
            },
            {
              "fieldId": "sendinblue_true_false",
              "fieldValue": "={{ $json[\"messageId\"] }}"
            },
            {
              "fieldId": "timestamp",
              "fieldValue": "={{ $node[\"Schedule Trigger1\"].json[\"timestamp\"] }}"
            }
          ]
        },
        "options": {
          "cellFormat": "USER_ENTERED"
        }
      },
      "id": "3e236c66-e27a-45b9-9fa0-f592a3ab5a9d",
      "name": "Google Sheets3",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 3,
      "position": [
        1720,
        580
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "15",
          "name": "Google Sheets - Kavi"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1YLMEmBnbZNbvwDypwpwoNQwV2Vc2OaGoVCkFnym5CGw",
          "mode": "list",
          "cachedResultName": "PNTracker - Ong",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1YLMEmBnbZNbvwDypwpwoNQwV2Vc2OaGoVCkFnym5CGw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1431005167,
          "mode": "list",
          "cachedResultName": "DISQAL",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1YLMEmBnbZNbvwDypwpwoNQwV2Vc2OaGoVCkFnym5CGw/edit#gid=1431005167"
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "id",
              "fieldValue": "={{ $node[\"Postgres2\"].json[\"id\"] }}"
            },
            {
              "fieldId": "reg_no",
              "fieldValue": "={{ $node[\"Postgres2\"].json[\"registration_no\"] }}"
            },
            {
              "fieldId": "host_name",
              "fieldValue": "={{ $node[\"Postgres2\"].json[\"host_name\"] }}"
            },
            {
              "fieldId": "ovr_rej",
              "fieldValue": "={{ $node[\"Postgres2\"].json[\"real_rej_booking\"] }}"
            },
            {
              "fieldId": "week_rej",
              "fieldValue": "={{ $node[\"Postgres2\"].json[\"weekend_real_rej_booking\"] }}"
            },
            {
              "fieldId": "lp_true_false",
              "fieldValue": "={{ $json[\"response\"][0][\"success\"] }}"
            },
            {
              "fieldId": "sendinblue_true_false",
              "fieldValue": "={{ $json[\"messageId\"] }}"
            },
            {
              "fieldId": "timestamp",
              "fieldValue": "={{ $node[\"Schedule Trigger1\"].json[\"timestamp\"] }}"
            }
          ]
        },
        "options": {
          "cellFormat": "USER_ENTERED"
        }
      },
      "id": "a5eba933-e7c6-463f-a324-c08ef1bc4358",
      "name": "Google Sheets4",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 3,
      "position": [
        1720,
        1000
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "15",
          "name": "Google Sheets - Kavi"
        }
      },
      "disabled": true
    }
  ],
  "pinData": {},
  "settings": {
    "callerPolicy": "any",
    "errorWorkflow": "11",
    "saveDataSuccessExecution": "all",
    "saveManualExecutions": false
  },
  "staticData": {
    "node:Schedule Trigger": {
      "recurrencyRules": []
    },
    "global": {
      "oldListingIds": [
        "SYX6134",
        45416,
        "VKM2868",
        "JSU9363",
        "VJF7444",
        "VBW8858",
        37063,
        "SAC2862E",
        4751,
        "BNM645",
        "BPF1747",
        "WC8942P",
        "KFF662",
        "RQ5850",
        "BNB6229",
        "JQC8977",
        "VFE7158",
        "SYA243",
        "VKE1003",
        "SAC6046F",
        "VJY9591",
        "VBF5687",
        "VBF7045",
        "VBF7045",
        "VBF7043",
        "VBF7042",
        "JUC6525",
        "AMV257",
        "SYC1419",
        29135,
        "JGV1212",
        "WC3458U",
        "MCV8577",
        "SYW5566",
        "SAA3388A",
        "SD8666N",
        43598,
        "RAM3625",
        44032,
        "WB2005F",
        "SAA8280K",
        "WA7793E",
        "W9578D",
        "JWA7395",
        "PQL1900",
        "SAB9270X",
        "VJR3279",
        "VAN603",
        "JNQ3511",
        "JSK474",
        "SD1483T",
        "X526",
        25435,
        44198,
        "JVQ3894",
        "JVU1924",
        "SAC2457E",
        "NDN2875",
        "PNL3953",
        "JTS379",
        "PLQ9789",
        6401,
        43991,
        "PQJ5437",
        "VBM6263",
        "SY3953",
        "VAD5421",
        "TCM9789",
        "RAE7257",
        "VHY557",
        "VGQ4486",
        "SYQ3023",
        20013,
        "QAA1536X",
        11430,
        34085,
        40871,
        "VET5500",
        "WC6656A",
        "W5518S",
        "WC193Y",
        "VHT4267",
        44785,
        41953,
        37333,
        44490,
        45508,
        42215,
        "QTU300",
        "SMB97",
        "SAC7F",
        "VCN3558",
        "PNU3135",
        "VBK8924",
        "WYE4338",
        "VGJ2166",
        "BQY4706",
        43526,
        "PLN4711",
        44143,
        "VHF2327",
        "VCL627",
        "VFY360",
        "VKA6545",
        "SYU1229",
        42771,
        "SME3928",
        "KV9592E",
        "KEX6676",
        "SWE3348",
        "SYQ9914",
        "VCM1027",
        37547,
        "VT1554",
        "SYV1734",
        "SWD139",
        "PNA1012",
        "VHW7864",
        "TTB6482",
        44834,
        "SMF3280",
        "JTK4036",
        "TBV7791",
        "SYV1248",
        "BPV5787",
        43160,
        "JTC233",
        "JTC8348",
        "VCY6995",
        39691,
        11593,
        40399,
        38219,
        42089,
        "PMQ5308",
        15995,
        "PQM4892",
        "VKD4282",
        "JUV4579",
        44086,
        "VHA1656",
        "VFK992",
        36583,
        "NDW2005",
        "RAG4165",
        "KFL336",
        "VDN9073",
        "SYR1287",
        38861,
        27501,
        "JVV517",
        "VAX6632",
        "VJQ1762",
        "SMH9171",
        "TBU9923",
        "WD8648F",
        "WA8893G",
        "VHH8965",
        "PPJ8132",
        "VDD879",
        "WC927F",
        "BLH41",
        "SD7666M",
        "MDD4069",
        "VEW3788",
        "SAB1612W",
        "AMM879",
        "KBH55",
        "DDY1505",
        43500,
        "WA5935Q",
        "JSG1029",
        "W9153A",
        "VDS1669",
        "VFW5095",
        "WB9022D",
        "RAE8301",
        "NDH9591",
        "VCQ7271",
        "VCF3247",
        "AJS1902",
        "PPF2888",
        "VHQ609",
        "VFB3427",
        "VFP4562",
        24531,
        22940,
        38444,
        23056,
        6298,
        27750,
        "VFE7024",
        "VAW4857",
        "LF4501",
        "VAV9642",
        "WYQ1125",
        "WA1643M",
        "QAB9290C",
        "ST563X",
        39776,
        22669,
        17462,
        "VCN6755",
        "SB5733D",
        40888,
        24765,
        22119,
        36994,
        "PLJ2419",
        "WB7344W",
        "VBT5631",
        "SMG3100",
        "WA271V",
        42343,
        35632,
        "KV3026E",
        "SU3834G",
        "SAB8688X",
        "SAC3056B",
        "QM3699A",
        "VHC326",
        "KFF919",
        "RAD6193",
        "SYW4514",
        "SAC8435B",
        "VBM4960",
        "WXL9777",
        "WC8495B",
        "BQF720",
        "VAX5557",
        "BPJ7700",
        "JSG6718",
        "WC2110G",
        "W6322U",
        "SYK856",
        "TCC4900",
        "WC5716M",
        "VS6864",
        "JQE5841",
        "SYK1124",
        "PMU3025",
        "PPR6219",
        "VB3375",
        "WC9429D",
        "PQA6499",
        "BAD9999",
        "SAC203A",
        "AHG7111",
        "SWB8116",
        "AEL20",
        "SAC2878D",
        "SWF1483",
        "JSS7727",
        "WVN2168",
        "KV9679E",
        "VK8672",
        "WKN31",
        "WYK7700",
        "WXX9799",
        "ST1507X",
        "VEJ5140",
        "SYS860",
        "JRD2924",
        "VCL4662",
        "KV7170D",
        "DDE9166",
        "PMD9967",
        "VD4921",
        "KEP9850",
        "QM812K",
        "VHQ1387",
        "SS2150W",
        "BMK824",
        "PMK930",
        "NDF4198",
        "PNL1810",
        "VDR2788",
        1168,
        42131,
        2183,
        25442,
        34679,
        35434,
        36389,
        37809,
        42025,
        39795,
        18836,
        40348,
        41629,
        9872,
        38129,
        38980,
        40351,
        42293,
        20035,
        34796,
        39374,
        41105,
        20054,
        36923,
        27043,
        19995,
        39889,
        26974,
        39701,
        38092,
        41642,
        18799,
        39734,
        1740,
        40531,
        36804,
        38580,
        26805,
        14675,
        34334,
        40629,
        21248,
        28915,
        41586,
        41148,
        41139,
        39738,
        35016,
        27715,
        39435,
        26309,
        35073,
        2038,
        36791,
        39062,
        37948,
        38875,
        30729,
        39692,
        32406,
        24942,
        40221,
        38458,
        38202,
        37568,
        32750,
        35103,
        41550,
        39269,
        37792,
        36274,
        35383,
        25601,
        12864,
        41012,
        37433,
        32621,
        33630,
        27474,
        38553,
        21778,
        2497,
        40593,
        28185,
        31155,
        35009,
        1167,
        41172,
        34700,
        17005,
        41974,
        39461,
        39439,
        40705,
        33820,
        10983,
        1266,
        39774,
        34695,
        40850,
        36282,
        35342,
        40760,
        1166,
        14683,
        840,
        37105,
        38286,
        40753,
        28301,
        32796,
        33760,
        40946,
        39536,
        39717,
        40502,
        36721,
        36427,
        36069,
        32385,
        40786,
        37724,
        37392,
        6871,
        41785,
        37198,
        31404,
        39170,
        37529,
        39371,
        39373,
        36415,
        36968,
        39960,
        19972,
        40670,
        17984,
        39343,
        40835,
        39622,
        30316,
        41135,
        31632,
        34878,
        38573,
        33659,
        41011,
        35567,
        38925,
        34917,
        40896,
        37706,
        39999,
        39279,
        9708,
        38912,
        33302,
        6107,
        29539,
        39837,
        38311,
        38218,
        28724,
        35373,
        9552,
        27319,
        848,
        28436,
        6,
        1,
        2,
        3,
        4,
        5,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null
      ]
    },
    "node:Schedule Trigger1": {
      "recurrencyRules": []
    }
  },
  "tags": [],
  "triggerCount": 1,
  "updatedAt": "2023-05-18T06:05:41.571Z",
  "versionId": "b0b7717b-62d7-4060-8741-c7315fbc5b32"
}